blueprint:
  name: Paralelo Virtual por Grupo (Simplificado)
  description: >
    Sincroniza um grupo (ZHA Group ou group do HA) com cliques em um ou mais canais (ex.: TS0003).
    Versão simplificada que controla apenas o grupo.
  domain: automation
  source_url: https://example.local/blueprints/paralelo-grupo-simples
  input:
    controladores:
      name: Canais/entidades controladoras
      description: Selecione os canais do TS0003 (ou outras entidades on/off) que disparam o paralelo
      selector:
        entity:
          multiple: true
          filter:
            - domain: light
            - domain: switch
    grupo_alvo:
      name: Grupo alvo
      description: Selecione o grupo que deve ligar/desligar (ZHA Group exposto como light.* ou group/luz do HA)
      selector:
        entity:
          multiple: false
          filter:
            - domain: light
            - domain: group
    atraso_ms:
      name: Atraso para estabilizar estados (ms)
      description: Evita comandos duplicados. Recomendo 100–200 ms.
      default: 150
      selector:
        number:
          min: 0
          max: 500
          unit_of_measurement: ms
          mode: slider
          step: 10

mode: queued
max: 3

trigger:
  - platform: state
    entity_id: !input controladores
    to:
      - "on"
      - "off"

variables:
  grupo: !input grupo_alvo
  atraso_ms: !input atraso_ms

action:
  # Pequeno atraso para evitar múltiplos disparos
  - delay:
      milliseconds: "{{ atraso_ms | int }}"
  
  # Pega o novo estado do controlador
  - variables:
      novo_estado: "{{ trigger.to_state.state }}"
  
  # Envia comando ao grupo
  - service: "light.turn_{{ novo_estado }}"
    target:
      entity_id: "{{ grupo }}"
